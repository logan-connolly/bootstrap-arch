---
- name: Setup system user
  hosts: localhost
  connection: local
  vars:
    user: archie
    group: users
  tasks:
    - name: Make sure we have a 'wheel' group
      group:
        name: wheel
        state: present

    - name: Add user and group
      user:
        name: '{{ user }}'
        group: '{{ group }}'
        shell: /usr/bin/zsh

    - name: Add user to wheel group
      lineinfile:
        path: /etc/sudoers
        state: present
        regexp: '^# %wheel ALL=(ALL) ALL'
        line: '%wheel ALL=(ALL) ALL'
